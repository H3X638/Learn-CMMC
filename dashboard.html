<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>CMMC Learning Portal â€“ Dashboard</title>
	<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&family=Poppins:wght@600&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="css/style.css" />
</head>

<body>
	<div class="app-container">
		<!-- Sidebar -->
		<aside class="sidebar">
			<div class="sidebar-header">
				<h2 class="logo">CMMC Portal</h2>
				<button id="toggleSidebar" class="sidebar-toggle">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<polyline points="15 18 9 12 15 6"></polyline>
					</svg>
				</button>
			</div>

			<nav>
				<ul>
					<li id="navOverview" class="active">
						<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
							<path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
						</svg>
						<span>Learning Overview</span>
					</li>
					<li id="navStrengths">
						<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<line x1="18" y1="20" x2="18" y2="10"></line>
							<line x1="12" y1="20" x2="12" y2="4"></line>
							<line x1="6" y1="20" x2="6" y2="14"></line>
						</svg>
						<span>Strengths</span>
					</li>
					<li id="navPractice">
						<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="10"></circle>
							<circle cx="12" cy="12" r="6"></circle>
							<circle cx="12" cy="12" r="2"></circle>
						</svg>
						<span>Practice</span>
					</li>
				</ul>
			</nav>

			<div class="logout-section">
				<button id="logoutBtn" class="secondary">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
						<polyline points="16 17 21 12 16 7"></polyline>
						<line x1="21" y1="12" x2="9" y2="12"></line>
					</svg>
					<span>Logout</span>
				</button>
			</div>
		</aside>

		<!-- Main Content -->
		<main class="content">
			<!-- View: Overview -->
			<section id="lessons" class="view">
				<header class="topbar overview-header">
					<div class="overview-grid">
						<div class="exam-countdown">
							<h1>Exam Countdown</h1>
							<p class="subtitle">Select your exam date to track remaining days.</p>
							<div class="calendar-controls">
								<label for="examDate">Exam Date:</label>
								<input type="date" id="examDate" />
								<p id="daysRemaining" class="countdown-text">No date set</p>
							</div>
						</div>

						<div class="progress-overview">
							<h2>Learning Progress</h2>
							<div class="progress-circle">
								<svg viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
									<circle class="progress-bg" cx="18" cy="18" r="15.9155"></circle>
									<circle class="progress-meter" cx="18" cy="18" r="15.9155"></circle>
									<text x="18" y="20.5" class="percentage">0%</text>
								</svg>
								<p class="percent-label">Lesson & Section Completion</p>
							</div>
						</div>
					</div>
				</header>

				<h2 class="section-title">Available Lessons</h2>
				<div class="cards"></div>
			</section>

			<!-- View: Strengths -->
			<section id="strengths" class="view hidden">
				<header class="topbar">
					<h1>Strengths & Weaknesses</h1>
					<p class="subtitle">Track your progress and see where you excel.</p>
				</header>

				<div class="strengths-container">
					<div class="strength-item">
						<h3>Lesson 1: Understanding CMMC</h3>
						<div class="strength-bar"><div class="strength-fill proficient"></div></div>
						<p class="level">Proficient</p>
					</div>

					<div class="strength-item">
						<h3>Lesson 2: NIST SP 800-171 Overview</h3>
						<div class="strength-bar"><div class="strength-fill intermediate"></div></div>
						<p class="level">Intermediate</p>
					</div>

					<div class="strength-item">
						<h3>Lesson 3: Assessment Readiness</h3>
						<div class="strength-bar"><div class="strength-fill beginner"></div></div>
						<p class="level">Beginner</p>
					</div>
				</div>
			</section>

			<!-- View: Practice -->
			<section id="practice" class="view hidden">
				<header class="topbar">
					<h1>Practice Mode</h1>
					<p class="subtitle">Test your knowledge with practice questions and quizzes.</p>
				</header>

				<div class="practice-container">
					<div class="practice-card">
						<h3>Quick Quiz</h3>
						<p>Try a 10-question timed quiz to test your understanding.</p>
						<button class="primary">Start Quick Quiz</button>
					</div>

					<div class="practice-card">
						<h3>Full-Length Practice Exam</h3>
						<p>Take the full 100-question CCP-style practice test with explanations.</p>
						<button class="primary">Start Exam</button>
					</div>
				</div>
			</section>
		</main>
	</div>

	<!-- Firebase + Logic -->
	<script type="module">
		import { lessons } from "./js/lessons.js";
		import { requireAuth, getUser, logout } from "./js/firebase.js";

		// --- Firebase Auth ---
		requireAuth();
		getUser((user) => {
			if (user) console.log("User:", user.email);
		});
		document.getElementById("logoutBtn").addEventListener("click", logout);

		// --- Render Lessons Dynamically ---
		const cardsContainer = document.querySelector(".cards");
		if (lessons && lessons.length > 0) {
			lessons.forEach((lesson) => {
				const card = document.createElement("div");
				card.classList.add("lesson-card");
				card.innerHTML = `
					<h3>Lesson ${lesson.id}: ${lesson.title}</h3>
					<p>${lesson.focus}</p>
					<button class="primary" data-lesson-id="${lesson.id}">Start Lesson</button>
				`;
				card.querySelector("button").addEventListener("click", () => {
					window.location.href = `Lessons/lesson${lesson.id}/index.html`;
				});
				cardsContainer.appendChild(card);
			});
		} else {
			cardsContainer.innerHTML = "<p>No lessons found. Check your lessons.js file.</p>";
		}

		// --- Sidebar Navigation ---
		const views = {
			overview: document.getElementById("lessons"),
			strengths: document.getElementById("strengths"),
			practice: document.getElementById("practice"),
		};

		const navItems = {
			overview: document.getElementById("navOverview"),
			strengths: document.getElementById("navStrengths"),
			practice: document.getElementById("navPractice"),
		};

		function showView(viewName) {
			Object.values(views).forEach((v) => v.classList.add("hidden"));
			Object.values(navItems).forEach((n) => n.classList.remove("active"));
			views[viewName].classList.remove("hidden");
			navItems[viewName].classList.add("active");
		}

		navItems.overview.addEventListener("click", () => showView("overview"));
		navItems.strengths.addEventListener("click", () => showView("strengths"));
		navItems.practice.addEventListener("click", () => showView("practice"));

		// --- Exam Countdown ---
		const examDateInput = document.getElementById("examDate");
		const daysRemainingEl = document.getElementById("daysRemaining");

		// Set minimum date to today
		const today = new Date().toISOString().split('T')[0];
		examDateInput.setAttribute('min', today);

		const savedDate = localStorage.getItem("examDate");
		if (savedDate) {
			examDateInput.value = savedDate;
			updateCountdown(savedDate);
		}

		examDateInput.addEventListener("change", (e) => {
			const selectedDate = e.target.value;
			localStorage.setItem("examDate", selectedDate);
			updateCountdown(selectedDate);
		});

		function updateCountdown(dateString) {
			const today = new Date();
			today.setHours(0, 0, 0, 0);
			const examDate = new Date(dateString);
			examDate.setHours(0, 0, 0, 0);
			const diffTime = examDate - today;
			const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

			if (isNaN(diffDays)) {
				daysRemainingEl.textContent = "No date set";
			} else if (diffDays < 0) {
				daysRemainingEl.textContent = "Exam date has passed!";
			} else if (diffDays === 0) {
				daysRemainingEl.textContent = "Exam day is today!";
			} else {
				daysRemainingEl.textContent = `${diffDays} day${diffDays !== 1 ? "s" : ""} until exam`;
			}
		}

		// --- Progress Circle ---
		function calculateLessonProgress() {
			const totalLessons = lessons.length;
			const completedLessons = 2; // Update based on actual completion
			const percent = Math.round((completedLessons / totalLessons) * 100);
			updateProgressCircle(percent);
		}

		function updateProgressCircle(percent) {
			const meter = document.querySelector(".progress-meter");
			const text = document.querySelector(".percentage");
			meter.setAttribute("stroke-dasharray", `${percent},100`);
			text.textContent = `${percent}%`;
		}

		calculateLessonProgress();

		// --- Sidebar Collapse ---
		const sidebar = document.querySelector(".sidebar");
		const toggleSidebar = document.getElementById("toggleSidebar");

		toggleSidebar.addEventListener("click", () => {
			sidebar.classList.toggle("collapsed");
			const icon = toggleSidebar.querySelector("svg");
			
			if (sidebar.classList.contains("collapsed")) {
				// Change to right-pointing chevron
				icon.innerHTML = '<polyline points="9 18 15 12 9 6"></polyline>';
			} else {
				// Change to left-pointing chevron
				icon.innerHTML = '<polyline points="15 18 9 12 15 6"></polyline>';
			}
		});
	</script>
</body>
</html>